name: Build Resume (PDF + HTML) and Deploy Pages

on:
  push:
    paths:
      - "**.tex"
      - ".github/workflows/build.yml"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # --- 1. Build PDF (Uses the high-quality LaTeX container) ---
      - name: Compile LaTeX to PDF
        uses: xu-cheng/latex-action@v3
        with:
          root_file: resume.tex
          latexmk_use_xelatex: true

      # --- 2. Build HTML (Uses Pandoc - Fast & Pre-installed) ---
      - name: Compile LaTeX to HTML via Pandoc
        run: |
          mkdir -p site
          # Pandoc handles fontawesome and standard packages gracefully
          pandoc resume.tex -s -o site/index.html
          
          # Copy the PDF into the site folder so it's downloadable
          cp resume.pdf site/resume.pdf

      # --- 3. Commit PDF back to main branch ---
      # This ensures your repo always shows the latest PDF
      - name: Commit PDF back to repo
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add resume.pdf
          git diff --cached --quiet || (git commit -m "Auto-update resume PDF" && git push)

      # --- 4. Deploy to GitHub Pages ---
      # This hosts your resume at https://<username>.github.io/<repo>/
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site
          publish_branch: gh-pages
